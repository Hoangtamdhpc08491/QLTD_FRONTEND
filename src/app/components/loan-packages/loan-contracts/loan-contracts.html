<app-header></app-header>

<div class="loan-contracts-page">
  <!-- Page Header -->
  <section class="page-header">
    <div class="container">
      <div class="header-content">
        <h1>H·ª£p ƒë·ªìng vay c·ªßa t√¥i</h1>
        <p>Qu·∫£n l√Ω v√† theo d√µi c√°c ƒë∆°n vay ƒë√£ g·ª≠i</p>
      </div>
      <div class="header-actions">
        <a routerLink="/goi-vay" class="btn btn-primary">
          <i class="icon-plus"></i>
          T·∫°o ƒë∆°n vay m·ªõi
        </a>
      </div>
    </div>
  </section>

  <!-- Error Display -->
  <div class="error-container" *ngIf="error">
    <div class="container">
      <div class="alert alert-error">
        {{error}}
        <button type="button" class="close-btn" (click)="error = null">√ó</button>
      </div>
    </div>
  </div>

  <!-- Filters and Search -->
  <section class="filters-section">
    <div class="container">
      <div class="filters-row">
        <div class="search-box">
          <input 
            type="text" 
            [(ngModel)]="searchTerm"
            (ngModelChange)="onSearchChange()"
            placeholder="T√¨m ki·∫øm theo t√™n, email..."
            class="search-input">
          <i class="search-icon">üîç</i>
        </div>

        <div class="filter-group">
          <label>Tr·∫°ng th√°i:</label>
          <select 
            [(ngModel)]="selectedStatus"
            (ngModelChange)="onFilterChange()"
            class="filter-select">
            <option *ngFor="let option of statusOptions" [value]="option.value">
              {{option.label}}
            </option>
          </select>
        </div>

        <div class="filter-group">
          <label>S·∫Øp x·∫øp:</label>
          <select 
            [(ngModel)]="sortBy"
            (ngModelChange)="onSortChange()"
            class="filter-select">
            <option *ngFor="let option of sortOptions" [value]="option.value">
              {{option.label}}
            </option>
          </select>
        </div>

        <div class="filter-group">
          <select 
            [(ngModel)]="sortOrder"
            (ngModelChange)="onSortChange()"
            class="filter-select">
            <option value="desc">Gi·∫£m d·∫ßn</option>
            <option value="asc">TƒÉng d·∫ßn</option>
          </select>
        </div>
      </div>
    </div>
  </section>

  <!-- Contracts List -->
  <section class="contracts-section">
    <div class="container">
      <!-- Loading State -->
      <div class="loading-container" *ngIf="isLoading">
        <div class="spinner"></div>
        <p>ƒêang t·∫£i danh s√°ch h·ª£p ƒë·ªìng...</p>
      </div>

      <!-- Empty State -->
      <div class="empty-state" *ngIf="!isLoading && contracts.length === 0">
        <div class="empty-icon">üìÑ</div>
        <h3>Ch∆∞a c√≥ h·ª£p ƒë·ªìng vay n√†o</h3>
        <p>B·∫°n ch∆∞a g·ª≠i ƒë∆°n vay n√†o. H√£y t·∫°o ƒë∆°n vay ƒë·∫ßu ti√™n c·ªßa b·∫°n.</p>
        <a routerLink="/goi-vay" class="btn btn-primary">T·∫°o ƒë∆°n vay m·ªõi</a>
      </div>

      <!-- Contracts Table -->
      <div class="contracts-table" *ngIf="!isLoading && contracts.length > 0">
        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th>M√£ ƒë∆°n</th>
                <th>G√≥i vay</th>
                <th>S·ªë ti·ªÅn</th>
                <th>Th·ªùi h·∫°n</th>
                <th>Tr·∫°ng th√°i</th>
                <th>Ng√†y t·∫°o</th>
                <th>H√†nh ƒë·ªông</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let contract of filteredContracts" class="contract-row">
                <td>
                  <span class="contract-id">#{{contract.id}}</span>
                </td>
                <td>
                  <div class="package-info">
                    <span class="package-name">{{contract.loanPackage?.name || 'N/A'}}</span>
                  </div>
                </td>
                <td>
                  <span class="loan-amount">{{formatCurrency(contract.loanAmount)}}</span>
                </td>
                <td>
                  <span class="loan-term">{{contract.loanTerm}} th√°ng</span>
                </td>
                <td>
                  <span class="status-badge" [class]="getStatusClass(contract.status)">
                    {{getStatusLabel(contract.status)}}
                  </span>
                </td>
                <td>
                  <span class="created-date">{{formatDate(contract.createdAt)}}</span>
                </td>
                <td>
                  <div class="action-buttons">
                    <button 
                      type="button"
                      class="btn btn-sm btn-info"
                      (click)="viewContract(contract)"
                      title="Xem chi ti·∫øt">
                      üëÅÔ∏è
                    </button>
                    
                   
                    
                    <button 
                      type="button"
                      class="btn btn-sm btn-danger"
                      *ngIf="canDelete(contract)"
                      (click)="deleteContract(contract)"
                      title="X√≥a">
                      üóëÔ∏è
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Pagination -->
      <div class="pagination-container" *ngIf="!isLoading && totalPages > 1">
        <div class="pagination-info">
          <span>
            Hi·ªÉn th·ªã {{(currentPage - 1) * itemsPerPage + 1}} - 
            {{Math.min(currentPage * itemsPerPage, totalCount)}} 
            trong t·ªïng s·ªë {{totalCount}} h·ª£p ƒë·ªìng
          </span>
        </div>
        
        <div class="pagination">
          <button 
            class="page-btn"
            [disabled]="currentPage === 1"
            (click)="previousPage()">
            ¬´ Tr∆∞·ªõc
          </button>
          
          <button 
            *ngFor="let page of getPaginationPages()"
            class="page-btn"
            [class.active]="page === currentPage"
            (click)="goToPage(page)">
            {{page}}
          </button>
          
          <button 
            class="page-btn"
            [disabled]="currentPage === totalPages"
            (click)="nextPage()">
            Sau ¬ª
          </button>
        </div>
      </div>
    </div>
  </section>
</div>

<app-footer></app-footer>
