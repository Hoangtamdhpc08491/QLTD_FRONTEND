<div class="loan-packages-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-left">
      <h1>Qu·∫£n L√Ω G√≥i Vay</h1>
      <p>Qu·∫£n l√Ω c√°c g√≥i vay v√† s·∫£n ph·∫©m t√≠n d·ª•ng</p>
    </div>
    <div class="header-right">
      <button class="btn btn-primary" (click)="openCreateModal()">
        <span class="icon">‚ûï</span>
        Th√™m G√≥i Vay
      </button>
      <button class="btn btn-secondary" (click)="exportToExcel()">
        <span class="icon">üìä</span>
        Xu·∫•t Excel
      </button>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-section">
    <div class="filter-group">
      <div class="search-box">
        <input 
          type="text" 
          placeholder="T√¨m ki·∫øm theo t√™n g√≥i, m√¥ t·∫£..." 
          [(ngModel)]="searchTerm"
          (input)="applyFilters()"
          class="search-input">
        <span class="search-icon">üîç</span>
      </div>
      
      <select 
        [(ngModel)]="statusFilter" 
        (change)="applyFilters()"
        class="filter-select">
        <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
        <option value="Ho·∫°t ƒë·ªông">Ho·∫°t ƒë·ªông</option>
        <option value="T·∫°m d·ª´ng">T·∫°m d·ª´ng</option>
        <option value="Ng·ª´ng ho·∫°t ƒë·ªông">Ng·ª´ng ho·∫°t ƒë·ªông</option>
      </select>
    </div>
  </div>

  <!-- Packages Table -->
  <div class="table-container">
    <table class="packages-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>T√™n G√≥i</th>
          <th>L√£i Su·∫•t</th>
          <th>S·ªë Ti·ªÅn</th>
          <th>Th·ªùi H·∫°n</th>
          <th>Tr·∫°ng Th√°i</th>
          <th>L∆∞·ª£t ƒêƒÉng K√Ω</th>
          <th>Th·ª© T·ª±</th>
          <th>Thao T√°c</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let pkg of getPaginatedPackages()" class="package-row">
          <td class="package-id">{{pkg.id}}</td>
          <td class="package-name">
            <div class="name-info">
              <h4>{{pkg.tenGoi}}</h4>
              <p>{{pkg.moTa}}</p>
            </div>
          </td>
          <td class="interest-rate">{{pkg.laiSuat}}%</td>
          <td class="amount-range">
            <div class="range-info">
              <span class="min">{{formatCurrency(pkg.soTienToiThieu)}}</span>
              <span class="separator">-</span>
              <span class="max">{{formatCurrency(pkg.soTienToiDa)}}</span>
            </div>
          </td>
          <td class="term-range">
            <div class="range-info">
              <span class="min">{{pkg.thoiHanToiThieu}} th√°ng</span>
              <span class="separator">-</span>
              <span class="max">{{pkg.thoiHanToiDa}} th√°ng</span>
            </div>
          </td>
          <td class="status">
            <span class="status-badge" [class]="getStatusClass(pkg.trangThai)">
              {{pkg.trangThai}}
            </span>
          </td>
          <td class="registration-count">
            <span class="count">{{pkg.luotDangKy}}</span>
            <button class="btn-link" (click)="viewApplications(pkg.id)">Xem</button>
          </td>
          <td class="display-order">{{pkg.thuTuHienThi}}</td>
          <td class="actions">
            <div class="action-buttons">
              <button 
                class="btn btn-sm btn-primary" 
                (click)="openEditModal(pkg)"
                title="Ch·ªânh s·ª≠a">
                ‚úèÔ∏è
              </button>
              <button 
                class="btn btn-sm" 
                [class.btn-warning]="pkg.trangThai === 'Ho·∫°t ƒë·ªông'"
                [class.btn-success]="pkg.trangThai === 'T·∫°m d·ª´ng'"
                (click)="toggleStatus(pkg)"
                [title]="pkg.trangThai === 'Ho·∫°t ƒë·ªông' ? 'T·∫°m d·ª´ng' : 'K√≠ch ho·∫°t'">
                {{pkg.trangThai === 'Ho·∫°t ƒë·ªông' ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è'}}
              </button>
              <button 
                class="btn btn-sm btn-danger" 
                (click)="openDeleteModal(pkg)"
                title="X√≥a">
                üóëÔ∏è
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Empty State -->
    <div *ngIf="getPaginatedPackages().length === 0" class="empty-state">
      <div class="empty-icon">üì¶</div>
      <h3>Kh√¥ng c√≥ g√≥i vay n√†o</h3>
      <p>Ch∆∞a c√≥ g√≥i vay n√†o ƒë∆∞·ª£c t·∫°o ho·∫∑c kh√¥ng c√≥ k·∫øt qu·∫£ ph√π h·ª£p v·ªõi b·ªô l·ªçc.</p>
      <button class="btn btn-primary" (click)="openCreateModal()">
        Th√™m G√≥i Vay ƒê·∫ßu Ti√™n
      </button>
    </div>
  </div>

  <!-- Pagination -->
  <div class="pagination-container" *ngIf="totalPages > 1">
    <div class="pagination-info">
      Hi·ªÉn th·ªã {{(currentPage - 1) * itemsPerPage + 1}} - 
      {{getMaxItemDisplay()}} 
      trong t·ªïng s·ªë {{filteredPackages.length}} g√≥i vay
    </div>
    
    <div class="pagination">
      <button 
        class="pagination-btn" 
        [disabled]="currentPage === 1"
        (click)="goToPage(currentPage - 1)">
        ‚Äπ Tr∆∞·ªõc
      </button>
      
      <button 
        *ngFor="let page of [].constructor(totalPages); let i = index"
        class="pagination-btn"
        [class.active]="currentPage === i + 1"
        (click)="goToPage(i + 1)">
        {{i + 1}}
      </button>
      
      <button 
        class="pagination-btn" 
        [disabled]="currentPage === totalPages"
        (click)="goToPage(currentPage + 1)">
        Sau ‚Ä∫
      </button>
    </div>
  </div>
</div>

<!-- Create/Edit Modal -->
<div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{modalTitle}}</h2>
      <button class="modal-close" (click)="closeModal()">‚úï</button>
    </div>
    
    <div class="modal-body">
      <form class="package-form">
        <!-- Basic Info -->
        <div class="form-section">
          <h3>Th√¥ng Tin C∆° B·∫£n</h3>
          
          <div class="form-row">
            <div class="form-group">
              <label>T√™n G√≥i Vay *</label>
              <input 
                type="text" 
                [(ngModel)]="packageForm.tenGoi" 
                name="tenGoi"
                placeholder="Nh·∫≠p t√™n g√≥i vay"
                required>
            </div>
            
            <div class="form-group">
              <label>Tr·∫°ng Th√°i</label>
              <select [(ngModel)]="packageForm.trangThai" name="trangThai">
                <option value="Ho·∫°t ƒë·ªông">Ho·∫°t ƒë·ªông</option>
                <option value="T·∫°m d·ª´ng">T·∫°m d·ª´ng</option>
                <option value="Ng·ª´ng ho·∫°t ƒë·ªông">Ng·ª´ng ho·∫°t ƒë·ªông</option>
              </select>
            </div>
          </div>
          
          <div class="form-group">
            <label>M√¥ T·∫£ *</label>
            <textarea 
              [(ngModel)]="packageForm.moTa" 
              name="moTa"
              placeholder="Nh·∫≠p m√¥ t·∫£ chi ti·∫øt v·ªÅ g√≥i vay"
              rows="3"
              required></textarea>
          </div>
        </div>

        <!-- Financial Info -->
        <div class="form-section">
          <h3>Th√¥ng Tin T√†i Ch√≠nh</h3>
          
          <div class="form-row">
            <div class="form-group">
              <label>L√£i Su·∫•t (%/th√°ng) *</label>
              <input 
                type="number" 
                [(ngModel)]="packageForm.laiSuat" 
                name="laiSuat"
                step="0.1"
                min="0"
                placeholder="0.0"
                required>
            </div>
            
            <div class="form-group">
              <label>Ph√≠ X·ª≠ L√Ω (VND)</label>
              <input 
                type="number" 
                [(ngModel)]="packageForm.phiXuLy" 
                name="phiXuLy"
                min="0"
                placeholder="0">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label>S·ªë Ti·ªÅn T·ªëi Thi·ªÉu (VND) *</label>
              <input 
                type="number" 
                [(ngModel)]="packageForm.soTienToiThieu" 
                name="soTienToiThieu"
                min="0"
                placeholder="0"
                required>
            </div>
            
            <div class="form-group">
              <label>S·ªë Ti·ªÅn T·ªëi ƒêa (VND) *</label>
              <input 
                type="number" 
                [(ngModel)]="packageForm.soTienToiDa" 
                name="soTienToiDa"
                min="0"
                placeholder="0"
                required>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label>Th·ªùi H·∫°n T·ªëi Thi·ªÉu (th√°ng) *</label>
              <input 
                type="number" 
                [(ngModel)]="packageForm.thoiHanToiThieu" 
                name="thoiHanToiThieu"
                min="1"
                placeholder="1"
                required>
            </div>
            
            <div class="form-group">
              <label>Th·ªùi H·∫°n T·ªëi ƒêa (th√°ng) *</label>
              <input 
                type="number" 
                [(ngModel)]="packageForm.thoiHanToiDa" 
                name="thoiHanToiDa"
                min="1"
                placeholder="1"
                required>
            </div>
          </div>
          
          <div class="form-group">
            <label>Th·ª© T·ª± Hi·ªÉn Th·ªã</label>
            <input 
              type="number" 
              [(ngModel)]="packageForm.thuTuHienThi" 
              name="thuTuHienThi"
              min="1"
              placeholder="1">
          </div>
        </div>

        <!-- Conditions -->
        <div class="form-section">
          <h3>ƒêi·ªÅu Ki·ªán Vay</h3>
          
          <div class="dynamic-list">
            <div *ngFor="let condition of packageForm.dieuKien; let i = index; trackBy: trackByIndex" 
                 class="dynamic-item">
              <input 
                type="text" 
                [(ngModel)]="packageForm.dieuKien![i]" 
                [name]="'condition_' + i"
                placeholder="Nh·∫≠p ƒëi·ªÅu ki·ªán vay">
              <button 
                type="button" 
                class="btn-remove" 
                (click)="removeCondition(i)"
                *ngIf="packageForm.dieuKien!.length > 1">
                ‚úï
              </button>
            </div>
            
            <button type="button" class="btn-add" (click)="addCondition()">
              ‚ûï Th√™m ƒêi·ªÅu Ki·ªán
            </button>
          </div>
        </div>

        <!-- Required Documents -->
        <div class="form-section">
          <h3>T√†i Li·ªáu C·∫ßn Thi·∫øt</h3>
          
          <div class="dynamic-list">
            <div *ngFor="let doc of packageForm.taiLieuCanThiet; let i = index; trackBy: trackByIndex" 
                 class="dynamic-item">
              <input 
                type="text" 
                [(ngModel)]="packageForm.taiLieuCanThiet![i]" 
                [name]="'document_' + i"
                placeholder="Nh·∫≠p t√†i li·ªáu c·∫ßn thi·∫øt">
              <button 
                type="button" 
                class="btn-remove" 
                (click)="removeDocument(i)"
                *ngIf="packageForm.taiLieuCanThiet!.length > 1">
                ‚úï
              </button>
            </div>
            
            <button type="button" class="btn-add" (click)="addDocument()">
              ‚ûï Th√™m T√†i Li·ªáu
            </button>
          </div>
        </div>
      </form>
    </div>
    
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeModal()">H·ªßy</button>
      <button class="btn btn-primary" (click)="savePackage()">
        {{isEditMode ? 'C·∫≠p Nh·∫≠t' : 'T·∫°o M·ªõi'}}
      </button>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal-overlay" *ngIf="showDeleteModal" (click)="closeDeleteModal()">
  <div class="modal-content modal-small" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>X√°c Nh·∫≠n X√≥a</h2>
      <button class="modal-close" (click)="closeDeleteModal()">‚úï</button>
    </div>
    
    <div class="modal-body">
      <div class="delete-confirmation">
        <div class="warning-icon">‚ö†Ô∏è</div>
        <h3>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a g√≥i vay n√†y?</h3>
        <p><strong>{{packageToDelete?.tenGoi}}</strong></p>
        <p class="warning-text">H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!</p>
      </div>
    </div>
    
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeDeleteModal()">H·ªßy</button>
      <button class="btn btn-danger" (click)="confirmDelete()">X√≥a</button>
    </div>
  </div>
</div>
