<div class="admin-user-management">
  <!-- Header -->
  <div class="page-header">
    <h1>Qu·∫£n l√Ω ng∆∞·ªùi d√πng</h1>
    <div class="header-actions">
      <button class="btn btn-primary" (click)="createUser()">
        ‚ûï Th√™m ng∆∞·ªùi d√πng
      </button>
      <button class="btn btn-outline" (click)="exportToExcel()">
        üìä Xu·∫•t Excel
      </button>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-section">
    <div class="search-box">
      <input type="text" 
             [(ngModel)]="searchTerm" 
             (ngModelChange)="applyFilters()"
             placeholder="T√¨m ki·∫øm theo t√™n, email, username, SƒêT..."
             class="search-input">
      <span class="search-icon">üîç</span>
    </div>

    <div class="filter-controls">
      <select [(ngModel)]="creditRatingFilter" 
              (ngModelChange)="applyFilters()"
              class="filter-select">
        <option value="">T·∫•t c·∫£ ƒë√°nh gi√°</option>
        <option value="excellent">Xu·∫•t s·∫Øc</option>
        <option value="good">T·ªët</option>
        <option value="average">Trung b√¨nh</option>
        <option value="poor">K√©m</option>
        <option value="unknown">Ch∆∞a x√°c ƒë·ªãnh</option>
      </select>
    </div>
  </div>

  <!-- Results Summary -->
  <div class="results-summary">
    <p>Hi·ªÉn th·ªã {{getPaginatedUsers().length}} trong t·ªïng s·ªë {{filteredUsers.length}} ng∆∞·ªùi d√πng</p>
  </div>

  <!-- Users Table -->
  <div class="users-table-container">
    <!-- Loading state -->
    <div class="loading-state" *ngIf="isLoading">
      <div class="loading-spinner">‚è≥</div>
      <p>ƒêang t·∫£i d·ªØ li·ªáu...</p>
    </div>

    <!-- Error state -->
    <div class="error-state" *ngIf="error && !isLoading">
      <div class="error-icon">‚ùå</div>
      <h3>C√≥ l·ªói x·∫£y ra</h3>
      <p>{{error}}</p>
      <button class="btn btn-primary" (click)="loadUsers()">Th·ª≠ l·∫°i</button>
    </div>

    <table class="users-table" *ngIf="!isLoading && !error">
      <thead>
        <tr>
          <th>ID</th>
          <th>Th√¥ng tin c√° nh√¢n</th>
          <th>Li√™n h·ªá</th>
          <th>ƒê√°nh gi√° t√≠n d·ª•ng</th>
          <th>Vai tr√≤</th>
          <th>Ng√†y t·∫°o</th>
          <th>Thao t√°c</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of getPaginatedUsers()" class="user-row">
          <td class="user-id">
            <strong>{{user.id}}</strong>
          </td>
          
          <td class="user-info">
            <div class="user-details">
              <div class="user-name">{{user.name}}</div>
              <div class="username">&#64;{{user.username}}</div>
            </div>
          </td>

          <td class="contact-info">
            <div class="contact-details">
              <div class="email">{{user.email}}</div>
              <div class="phone">{{user.phone}}</div>
            </div>
          </td>

          <td class="credit-rating">
            <span class="credit-badge" [class]="getCreditRatingClass(user.creditRating)">
              {{getCreditRatingText(user.creditRating)}}
            </span>
          </td>

          <td class="role-cell">
            <span class="role-badge" [class]="user.role === 'admin' ? 'role-admin' : 'role-user'">
              {{getRoleText(user.role)}}
            </span>
          </td>

          <td class="date-cell">
            <div class="created-date">
              {{formatDate(user.createdAt)}}
            </div>
          </td>

          <td class="actions-cell">
            <div class="action-buttons">
              <button class="btn btn-xs btn-outline" (click)="viewUser(user)">
                üëÅÔ∏è Xem
              </button>
              <button class="btn btn-xs btn-primary" (click)="editUser(user)">
                ‚úèÔ∏è S·ª≠a
              </button>
              <button class="btn btn-xs btn-danger" (click)="deleteUser(user)">
                üóëÔ∏è X√≥a
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Empty state -->
    <div class="empty-state" *ngIf="!isLoading && !error && getPaginatedUsers().length === 0">
      <div class="empty-icon">üë•</div>
      <h3>Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi d√πng n√†o</h3>
      <p>Th·ª≠ thay ƒë·ªïi b·ªô l·ªçc ho·∫∑c t·ª´ kh√≥a t√¨m ki·∫øm</p>
    </div>
  </div>

  <!-- Pagination -->
  <div class="pagination" *ngIf="totalPages > 1">
    <button class="pagination-btn" 
            [disabled]="currentPage === 1"
            (click)="goToPage(currentPage - 1)">
      ‚Äπ Tr∆∞·ªõc
    </button>

    <span class="pagination-info">
      Trang {{currentPage}} / {{totalPages}}
    </span>

    <button class="pagination-btn" 
            [disabled]="currentPage === totalPages"
            (click)="goToPage(currentPage + 1)">
      Sau ‚Ä∫
    </button>
  </div>
</div>

<!-- User Modal -->
<div class="modal-overlay" *ngIf="showUserModal" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>
        <span *ngIf="modalMode === 'view'">Chi ti·∫øt ng∆∞·ªùi d√πng</span>
        <span *ngIf="modalMode === 'edit'">Ch·ªânh s·ª≠a ng∆∞·ªùi d√πng</span>
        <span *ngIf="modalMode === 'create'">Th√™m ng∆∞·ªùi d√πng m·ªõi</span>
      </h2>
      <button class="modal-close" (click)="closeModal()">‚úï</button>
    </div>

    <div class="modal-body" *ngIf="selectedUser">
      <form class="user-form">
        <div class="form-grid">
          <div class="form-group">
            <label>T√™n ng∆∞·ªùi d√πng</label>
            <input type="text" 
                   [(ngModel)]="selectedUser.username" 
                   name="username"
                   [readonly]="modalMode === 'view'"
                   class="form-control"
                   placeholder="Nh·∫≠p t√™n ƒëƒÉng nh·∫≠p">
          </div>

          <div class="form-group">
            <label>H·ªç v√† t√™n</label>
            <input type="text" 
                   [(ngModel)]="selectedUser.name" 
                   name="name"
                   [readonly]="modalMode === 'view'"
                   class="form-control"
                   placeholder="Nh·∫≠p h·ªç v√† t√™n">
          </div>

          <div class="form-group">
            <label>Email</label>
            <input type="email" 
                   [(ngModel)]="selectedUser.email" 
                   name="email"
                   [readonly]="modalMode === 'view'"
                   class="form-control"
                   placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ email">
          </div>

          <div class="form-group">
            <label>S·ªë ƒëi·ªán tho·∫°i</label>
            <input type="tel" 
                   [(ngModel)]="selectedUser.phone" 
                   name="phone"
                   [readonly]="modalMode === 'view'"
                   class="form-control"
                   placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i">
          </div>

          <div class="form-group" *ngIf="modalMode === 'create'">
            <label>M·∫≠t kh·∫©u</label>
            <input type="password" 
                   [(ngModel)]="selectedUser.password" 
                   name="password"
                   class="form-control"
                   placeholder="Nh·∫≠p m·∫≠t kh·∫©u">
          </div>

          <div class="form-group">
            <label>Vai tr√≤</label>
            <select [(ngModel)]="selectedUser.role" 
                    name="role"
                    [disabled]="modalMode === 'view'"
                    class="form-control">
              <option value="user">Ng∆∞·ªùi d√πng</option>
              <option value="admin">Qu·∫£n tr·ªã vi√™n</option>
            </select>
          </div>

          <div class="form-group">
            <label>ƒê√°nh gi√° t√≠n d·ª•ng</label>
            <select [(ngModel)]="selectedUser.creditRating" 
                    name="creditRating"
                    [disabled]="modalMode === 'view'"
                    class="form-control">
              <option value="unknown">Ch∆∞a x√°c ƒë·ªãnh</option>
              <option value="poor">K√©m</option>
              <option value="average">Trung b√¨nh</option>
              <option value="good">T·ªët</option>
              <option value="excellent">Xu·∫•t s·∫Øc</option>
            </select>
          </div>
        </div>

        <!-- Information for existing users -->
        <div class="user-info-section" *ngIf="modalMode !== 'create'">
          <h3>Th√¥ng tin h·ªá th·ªëng</h3>
          <div class="info-grid">
            <div class="info-item">
              <span class="info-label">ID:</span>
              <span class="info-value">{{selectedUser.id}}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Ng√†y t·∫°o:</span>
              <span class="info-value">{{formatDate(selectedUser.createdAt)}}</span>
            </div>
            <div class="info-item">
              <span class="info-label">C·∫≠p nh·∫≠t l·∫ßn cu·ªëi:</span>
              <span class="info-value">{{formatDate(selectedUser.updatedAt)}}</span>
            </div>
          </div>
        </div>
      </form>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeModal()">ƒê√≥ng</button>
      <button class="btn btn-primary" 
              *ngIf="modalMode !== 'view'"
              (click)="saveUser()">
        <span *ngIf="modalMode === 'create'">T·∫°o</span>
        <span *ngIf="modalMode === 'edit'">L∆∞u</span>
      </button>
    </div>
  </div>
</div>
