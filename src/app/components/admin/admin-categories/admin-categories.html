<div class="categories-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-left">
      <h1>Qu·∫£n L√Ω Danh M·ª•c</h1>
      <p>Qu·∫£n l√Ω danh m·ª•c cho g√≥i vay, tin t·ª©c v√† h·ªó tr·ª£</p>
    </div>
    <div class="header-right">
      <button class="btn btn-primary" (click)="openCreateModal()">
        <span class="icon">‚ûï</span>
        Th√™m Danh M·ª•c
      </button>
      <button class="btn btn-secondary" (click)="exportToExcel()">
        <span class="icon">üìä</span>
        Xu·∫•t Excel
      </button>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-section">
    <div class="filter-group">
      <div class="search-box">
        <input 
          type="text" 
          placeholder="T√¨m ki·∫øm theo t√™n danh m·ª•c, m√¥ t·∫£..." 
          [(ngModel)]="searchTerm"
          (input)="applyFilters()"
          class="search-input">
        <span class="search-icon">üîç</span>
      </div>
      
      <select 
        [(ngModel)]="typeFilter" 
        (change)="applyFilters()"
        class="filter-select">
        <option value="">T·∫•t c·∫£ lo·∫°i</option>
        <option value="goi-vay">G√≥i Vay</option>
        <option value="tin-tuc">Tin T·ª©c</option>
        <option value="ho-tro">H·ªó Tr·ª£</option>
      </select>

      <select 
        [(ngModel)]="statusFilter" 
        (change)="applyFilters()"
        class="filter-select">
        <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
        <option value="Ho·∫°t ƒë·ªông">Ho·∫°t ƒë·ªông</option>
        <option value="T·∫°m d·ª´ng">T·∫°m d·ª´ng</option>
        <option value="Ng·ª´ng ho·∫°t ƒë·ªông">Ng·ª´ng ho·∫°t ƒë·ªông</option>
      </select>
    </div>
  </div>

  <!-- Categories Table -->
  <div class="table-container">
    <table class="categories-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Danh M·ª•c</th>
          <th>Lo·∫°i</th>
          <th>Tr·∫°ng Th√°i</th>
          <th>S·ªë B√†i Vi·∫øt</th>
          <th>Th·ª© T·ª±</th>
          <th>Ng√†y C·∫≠p Nh·∫≠t</th>
          <th>Thao T√°c</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let cat of getPaginatedCategories()" class="category-row">
          <td class="category-id">{{cat.id}}</td>
          <td class="category-info">
            <div class="category-header">
              <span class="category-icon" [style.color]="cat.mauSac">{{cat.icon}}</span>
              <div class="category-details">
                <h4>{{cat.tenDanhMuc}}</h4>
                <p>{{cat.moTa}}</p>
              </div>
            </div>
          </td>
          <td class="category-type">
            <span class="type-badge" [class]="getTypeClass(cat.loaiDanhMuc)">
              {{getTypeLabel(cat.loaiDanhMuc)}}
            </span>
          </td>
          <td class="status">
            <span class="status-badge" [class]="getStatusClass(cat.trangThai)">
              {{cat.trangThai}}
            </span>
          </td>
          <td class="content-count">
            <span class="count">{{cat.soLuongBaiViet}}</span>
            <button 
              class="btn-link" 
              (click)="viewContent(cat.id, cat.loaiDanhMuc)"
              *ngIf="cat.soLuongBaiViet > 0">
              Xem
            </button>
          </td>
          <td class="display-order">
            <div class="order-controls">
              <span class="order-number">{{cat.thuTuHienThi}}</span>
              <div class="order-buttons">
                <button 
                  class="btn-order" 
                  (click)="reorderCategory(cat, 'up')"
                  [disabled]="cat.thuTuHienThi === 1"
                  title="Di chuy·ªÉn l√™n">
                  ‚Üë
                </button>
                <button 
                  class="btn-order" 
                  (click)="reorderCategory(cat, 'down')"
                  title="Di chuy·ªÉn xu·ªëng">
                  ‚Üì
                </button>
              </div>
            </div>
          </td>
          <td class="update-date">
            {{cat.ngayCapNhat | date:'dd/MM/yyyy'}}
          </td>
          <td class="actions">
            <div class="action-buttons">
              <button 
                class="btn btn-sm btn-primary" 
                (click)="openEditModal(cat)"
                title="Ch·ªânh s·ª≠a">
                ‚úèÔ∏è
              </button>
              <button 
                class="btn btn-sm" 
                [class.btn-warning]="cat.trangThai === 'Ho·∫°t ƒë·ªông'"
                [class.btn-success]="cat.trangThai === 'T·∫°m d·ª´ng'"
                (click)="toggleStatus(cat)"
                [title]="cat.trangThai === 'Ho·∫°t ƒë·ªông' ? 'T·∫°m d·ª´ng' : 'K√≠ch ho·∫°t'">
                {{cat.trangThai === 'Ho·∫°t ƒë·ªông' ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è'}}
              </button>
              <button 
                class="btn btn-sm btn-danger" 
                (click)="openDeleteModal(cat)"
                title="X√≥a">
                üóëÔ∏è
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Empty State -->
    <div *ngIf="getPaginatedCategories().length === 0" class="empty-state">
      <div class="empty-icon">üìÇ</div>
      <h3>Kh√¥ng c√≥ danh m·ª•c n√†o</h3>
      <p>Ch∆∞a c√≥ danh m·ª•c n√†o ƒë∆∞·ª£c t·∫°o ho·∫∑c kh√¥ng c√≥ k·∫øt qu·∫£ ph√π h·ª£p v·ªõi b·ªô l·ªçc.</p>
      <button class="btn btn-primary" (click)="openCreateModal()">
        Th√™m Danh M·ª•c ƒê·∫ßu Ti√™n
      </button>
    </div>
  </div>

  <!-- Pagination -->
  <div class="pagination-container" *ngIf="totalPages > 1">
    <div class="pagination-info">
      Hi·ªÉn th·ªã {{(currentPage - 1) * itemsPerPage + 1}} - 
      {{getMaxItemDisplay()}} 
      trong t·ªïng s·ªë {{filteredCategories.length}} danh m·ª•c
    </div>
    
    <div class="pagination">
      <button 
        class="pagination-btn" 
        [disabled]="currentPage === 1"
        (click)="goToPage(currentPage - 1)">
        ‚Äπ Tr∆∞·ªõc
      </button>
      
      <button 
        *ngFor="let page of [].constructor(totalPages); let i = index"
        class="pagination-btn"
        [class.active]="currentPage === i + 1"
        (click)="goToPage(i + 1)">
        {{i + 1}}
      </button>
      
      <button 
        class="pagination-btn" 
        [disabled]="currentPage === totalPages"
        (click)="goToPage(currentPage + 1)">
        Sau ‚Ä∫
      </button>
    </div>
  </div>
</div>

<!-- Create/Edit Modal -->
<div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{modalTitle}}</h2>
      <button class="modal-close" (click)="closeModal()">‚úï</button>
    </div>
    
    <div class="modal-body">
      <form class="category-form">
        <!-- Basic Info -->
        <div class="form-section">
          <h3>Th√¥ng Tin C∆° B·∫£n</h3>
          
          <div class="form-row">
            <div class="form-group">
              <label for="tenDanhMuc">T√™n Danh M·ª•c *</label>
              <input 
                id="tenDanhMuc"
                type="text" 
                [(ngModel)]="categoryForm.tenDanhMuc" 
                name="tenDanhMuc"
                placeholder="Nh·∫≠p t√™n danh m·ª•c"
                required>
            </div>
            
            <div class="form-group">
              <label for="loaiDanhMuc">Lo·∫°i Danh M·ª•c *</label>
              <select 
                id="loaiDanhMuc"
                [(ngModel)]="categoryForm.loaiDanhMuc" 
                name="loaiDanhMuc"
                required>
                <option value="goi-vay">G√≥i Vay</option>
                <option value="tin-tuc">Tin T·ª©c</option>
                <option value="ho-tro">H·ªó Tr·ª£</option>
              </select>
            </div>
          </div>
          
          <div class="form-group">
            <label for="moTa">M√¥ T·∫£ *</label>
            <textarea 
              id="moTa"
              [(ngModel)]="categoryForm.moTa" 
              name="moTa"
              placeholder="Nh·∫≠p m√¥ t·∫£ chi ti·∫øt v·ªÅ danh m·ª•c"
              rows="3"
              required></textarea>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="trangThai">Tr·∫°ng Th√°i</label>
              <select 
                id="trangThai"
                [(ngModel)]="categoryForm.trangThai" 
                name="trangThai">
                <option value="Ho·∫°t ƒë·ªông">Ho·∫°t ƒë·ªông</option>
                <option value="T·∫°m d·ª´ng">T·∫°m d·ª´ng</option>
                <option value="Ng·ª´ng ho·∫°t ƒë·ªông">Ng·ª´ng ho·∫°t ƒë·ªông</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="thuTuHienThi">Th·ª© T·ª± Hi·ªÉn Th·ªã</label>
              <input 
                id="thuTuHienThi"
                type="number" 
                [(ngModel)]="categoryForm.thuTuHienThi" 
                name="thuTuHienThi"
                min="1"
                placeholder="1">
            </div>
          </div>
        </div>

        <!-- Visual Settings -->
        <div class="form-section">
          <h3>Thi·∫øt L·∫≠p Hi·ªÉn Th·ªã</h3>
          
          <div class="form-row">
            <div class="form-group">
              <label for="icon">Icon</label>
              <div class="icon-selector">
                <div class="current-icon" [style.color]="categoryForm.mauSac">
                  {{categoryForm.icon || 'üìù'}}
                </div>
                <select 
                  id="icon"
                  [(ngModel)]="categoryForm.icon" 
                  name="icon">
                  <option *ngFor="let icon of iconOptions" [value]="icon">
                    {{icon}}
                  </option>
                </select>
              </div>
            </div>
            
            <div class="form-group">
              <label for="mauSac">M√†u S·∫Øc</label>
              <div class="color-selector">
                <div class="current-color" [style.background-color]="categoryForm.mauSac">
                </div>
                <select 
                  id="mauSac"
                  [(ngModel)]="categoryForm.mauSac" 
                  name="mauSac">
                  <option *ngFor="let color of colorOptions" [value]="color.value">
                    {{color.label}}
                  </option>
                </select>
              </div>
            </div>
          </div>
          
          <!-- Preview -->
          <div class="preview-section">
            <h4>Xem Tr∆∞·ªõc</h4>
            <div class="category-preview">
              <span class="preview-icon" [style.color]="categoryForm.mauSac">
                {{categoryForm.icon || 'üìù'}}
              </span>
              <div class="preview-text">
                <h5>{{categoryForm.tenDanhMuc || 'T√™n danh m·ª•c'}}</h5>
                <p>{{categoryForm.moTa || 'M√¥ t·∫£ danh m·ª•c'}}</p>
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>
    
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeModal()">H·ªßy</button>
      <button class="btn btn-primary" (click)="saveCategory()">
        {{isEditMode ? 'C·∫≠p Nh·∫≠t' : 'T·∫°o M·ªõi'}}
      </button>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal-overlay" *ngIf="showDeleteModal" (click)="closeDeleteModal()">
  <div class="modal-content modal-small" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>X√°c Nh·∫≠n X√≥a</h2>
      <button class="modal-close" (click)="closeDeleteModal()">‚úï</button>
    </div>
    
    <div class="modal-body">
      <div class="delete-confirmation">
        <div class="warning-icon">‚ö†Ô∏è</div>
        <h3>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a danh m·ª•c n√†y?</h3>
        <p><strong>{{categoryToDelete?.tenDanhMuc}}</strong></p>
        <p class="warning-text">
          Danh m·ª•c c√≥ {{categoryToDelete?.soLuongBaiViet}} b√†i vi·∫øt. 
          H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!
        </p>
      </div>
    </div>
    
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeDeleteModal()">H·ªßy</button>
      <button class="btn btn-danger" (click)="confirmDelete()">X√≥a</button>
    </div>
  </div>
</div>
