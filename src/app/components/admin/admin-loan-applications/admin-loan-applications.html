<div class="admin-loan-applications">
  <!-- Header -->
  <div class="page-header">
    <h1>Qu·∫£n l√Ω ƒë∆°n vay</h1>
    <div class="header-actions">
      <button class="btn btn-outline" (click)="exportToExcel()">
        üìä Xu·∫•t Excel
      </button>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-section">
    <div class="search-box">
      <input type="text" 
             [(ngModel)]="searchTerm" 
             (ngModelChange)="applyFilters()"
             placeholder="T√¨m ki·∫øm theo t√™n, email, m√£ ƒë∆°n..."
             class="search-input">
      <span class="search-icon">üîç</span>
    </div>

    <div class="filter-controls">
      <select [(ngModel)]="statusFilter" 
              (ngModelChange)="applyFilters()"
              class="filter-select">
        <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
        <option value="pending">Ch·ªù duy·ªát</option>
        <option value="approved">ƒê√£ duy·ªát</option>
        <option value="rejected">T·ª´ ch·ªëi</option>
      </select>

      <input type="date" 
             [(ngModel)]="dateFilter"
             (ngModelChange)="applyFilters()"
             class="filter-date">
    </div>
  </div>

  <!-- Loading state -->
  <div class="loading-state" *ngIf="isLoading">
    <div class="loading-spinner">‚è≥</div>
    <p>ƒêang t·∫£i danh s√°ch ƒë∆°n vay...</p>
  </div>

  <!-- Results Summary -->
  <div class="results-summary" *ngIf="!isLoading">
    <p>Hi·ªÉn th·ªã {{getPaginatedApplications().length}} trong t·ªïng s·ªë {{totalCount}} ƒë∆°n vay</p>
  </div>

  <!-- Applications Table -->
  <div class="applications-table-container" *ngIf="!isLoading">
    <table class="applications-table">
      <thead>
        <tr>
          <th>M√£ ƒë∆°n</th>
          <th>Th√¥ng tin kh√°ch h√†ng</th>
          <th>G√≥i vay</th>
          <th>S·ªë ti·ªÅn</th>
          <th>Th·ªùi h·∫°n</th>
          <th>Ng√†y n·ªôp</th>
          <th>Tr·∫°ng th√°i</th>
          <th>Thao t√°c</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let app of getPaginatedApplications()" class="application-row">
          <td class="app-id">
            <strong>#{{app.id}}</strong>
          </td>
          
          <td class="customer-info">
            <div class="customer-details">
              <div class="customer-name">{{app.name}}</div>
              <div class="customer-contact">
                <small>{{app.email}}</small><br>
                <small>{{app.phone}}</small>
              </div>
              <div class="customer-job">
                <small>{{app.job}} - {{formatCurrency(app.salary)}}</small>
              </div>
            </div>
          </td>

          <td class="loan-package">
            <div class="package-info">
              <div class="package-name">{{app.loanPackage?.name || 'N/A'}}</div>
              <small>L√£i su·∫•t: {{app.interestRate}}%/nƒÉm</small>
            </div>
          </td>

          <td class="loan-amount">
            <div class="amount-details">
              <strong>{{formatCurrency(app.loanAmount)}}</strong>
              <br><small>T·ªïng: {{formatCurrency(app.totalAmount)}}</small>
            </div>
          </td>

          <td class="loan-term">
            {{app.loanTerm}} th√°ng
            <br><small>EMI: {{formatCurrency(app.EMI)}}</small>
          </td>

          <td class="submit-date">
            {{formatDate(app.createdAt)}}
          </td>

          <td class="status-cell">
            <span class="status-badge" [class]="getStatusClass(app.status)">
              {{getStatusText(app.status)}}
            </span>
            <div class="status-details" *ngIf="app.updatedAt && app.status !== 'pending'">
              <small>{{formatDate(app.updatedAt)}}</small>
            </div>
            <div class="status-note" *ngIf="app.note">
              <small>{{app.note}}</small>
            </div>
          </td>

          <td class="actions-cell">
            <div class="action-buttons">
              <button class="btn btn-sm btn-outline" (click)="viewApplication(app.id)">
                üëÅÔ∏è Xem
              </button>
              
              <ng-container *ngIf="app.status === 'pending'">
                <button class="btn btn-sm btn-success" (click)="approveApplication(app)">
                  ‚úÖ Duy·ªát
                </button>
                <button class="btn btn-sm btn-danger" (click)="showRejectModal(app)">
                  ‚ùå T·ª´ ch·ªëi
                </button>
              </ng-container>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Empty state -->
    <div class="empty-state" *ngIf="getPaginatedApplications().length === 0 && !isLoading">
      <div class="empty-icon">üìã</div>
      <h3>Kh√¥ng t√¨m th·∫•y ƒë∆°n vay n√†o</h3>
      <p>Th·ª≠ thay ƒë·ªïi b·ªô l·ªçc ho·∫∑c t·ª´ kh√≥a t√¨m ki·∫øm</p>
    </div>
  </div>

  <!-- Pagination -->
  <div class="pagination" *ngIf="totalPages > 1 && !isLoading">
    <button class="pagination-btn" 
            [disabled]="currentPage === 1"
            (click)="goToPage(currentPage - 1)">
      ‚Äπ Tr∆∞·ªõc
    </button>

    <span class="pagination-info">
      Trang {{currentPage}} / {{totalPages}} ({{totalCount}} ƒë∆°n vay)
    </span>

    <button class="pagination-btn" 
            [disabled]="currentPage === totalPages"
            (click)="goToPage(currentPage + 1)">
      Sau ‚Ä∫
    </button>
  </div>
</div>
